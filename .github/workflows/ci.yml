name: CI

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 5
      matrix:
        python-version: [3.9]

    steps:

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install hg-git with --user
      run: |
        cd $HOME
        pip install --upgrade pip
        pip install dulwich --user
        hg clone https://foss.heptapod.net/mercurial/hg-git/
        cd hg-git
        pip install -e . --user

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: build
      run: |
        hg version -v --config extensions.hggit=
        pip install . -v
